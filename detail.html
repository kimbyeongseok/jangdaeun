<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>장다은 Jang Daeun Works</title>
  <meta name="description" content="장다은 작가, 작업, 서울에서 활동, Jang Daeun - Works, Based in Seoul ">
  <meta name="keywords"
    content="장다은, 작가, 장다은 작가, 장다은 작업, Jang Da Eun, jang daeun, jang, daeun, works, work, review, artist, portfolio, art, exhibition, contemporary art, design, text, 한예종, 한국예술종합학교, 한예종 전문사, 두산, 두산아트센터, 두산갤러리, pp, 프라이머리 프랙디스, primary practce">
  <meta name="author" content="Jang Daeun">

  <!-- Open Graph (SNS 공유 최적화) -->
  <meta property="og:title" content="Jang Daeun">
  <meta property="og:description" content="Works and Texts">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://jangdaeun.com/">
  <meta property="og:image" content="https://jangdaeun.com/img/favicon.png">

  <!-- Twitter 카드 -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Jang Daeun">
  <meta name="twitter:description" content="Works and Texts">
  <meta name="twitter:image" content="https://jangdaeun.com/img/favicon.png">

  <!-- ✅ JSON-LD 구조화 데이터 -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Jang Da Eun",
    "alternateName": "장다은 작가",
    "url": "https://jangdaeun.com",
    "sameAs": [
      "https://www.instagram.com/qoo_jang"
    ],
    "description": "Jang Da Eun - Works, Based in Seoul",
    "jobTitle": "Artist",
    "worksFor": {
      "@type": "Organization",
      "name": "Independent"
    }
  }
  </script>
  <link rel="stylesheet" href="./style.css" />
  <link rel="icon" type="image/png" href="./img/favicon.png" />
</head>

<body>
  <header>
    <a href="./index.html">Jang Daeun</a>
  </header>
  <nav>
    <a class="tab" data-tab="art">Art</a>
    <a class="tab" data-tab="text">Text</a>
    <a class="tab" data-tab="cv" href="./index.html?nav=cv">CV</a>
    <a class="tab" data-tab="contact" href="./index.html?nav=contact">Contact</a>
  </nav>
  <div class="page-wrapper">
    <div class="subnav" id="subnavContainer">
      <a class="subtab" data-subtab="works">Works</a>
      <a class="subtab" data-subtab="drawings">Drawings</a>
      <a class="subtab" data-subtab="reviews">Reviews</a>
      <a class="subtab" data-subtab="texts">Texts</a>
    </div>
    <div class="content-area">
      <div class="content">
        <div class="detail">
          <div class="carousel-container">
            <div class="carousel-track" id="carouselTrack"></div>
          </div>
          <div class="slider" id="previewSlider"></div>
          <div id="detailText"></div>
        </div>
        <div class="back-btn">&lt; Show all</div>
      </div>
    </div>
  </div>

  <footer>
    <div class="top"></div>
    <div class="btm">© 2025 Jang Da Eun - All Rights Reserved</div>
  </footer>
  <script src="./data.js"></script>
  <script type="module">
    const contents = (window && window.contents) ? window.contents : [];

    // ===== URL Params =====
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const nav = params.get('nav');
    const subnav = params.get('subnav');

    // ===== 탭 활성화 (기존 동일) =====
    if (nav) {
      const navTab = document.querySelector(`.tab[data-tab="${nav}"]`);
      if (navTab) navTab.classList.add('active');
    }
    if (subnav) {
      const subTab = document.querySelector(`.subtab[data-subtab="${subnav}"]`);
      if (subTab) subTab.classList.add('active');
    }

    const subnavMap = { art: ['works', 'drawings'], text: ['reviews', 'texts'] };
    const allowedSubtabs = subnavMap[nav] || [];
    document.querySelectorAll('.subtab').forEach(tab => {
      const type = tab.getAttribute('data-subtab');
      tab.style.display = allowedSubtabs.includes(type) ? 'inline-block' : 'none';
    });

    // ===== 요소 =====
    const detail = contents.find(item => item.id === id);
    const carouselContainer = document.querySelector('.carousel-container'); // ★ 스크롤 주체
    const carouselTrack = document.getElementById('carouselTrack');
    const detailText = document.getElementById('detailText');
    const previewSlider = document.getElementById('previewSlider');

    let currentIndex = 0;

    // ===== 유틸 =====
    const getSlideWidth = () => {
      const first = carouselTrack.querySelector('img');
      return first ? first.clientWidth : carouselContainer.clientWidth || 1;
    };

    const centerThumbInSlider = (index) => {
      const el = previewSlider.children[index];
      if (!el) return;
      const targetLeft = el.offsetLeft - (previewSlider.clientWidth - el.clientWidth) / 2;
      previewSlider.scrollTo({ left: Math.max(0, targetLeft), behavior: 'smooth' });
    };

    const updateSliderActive = (index) => {
      const thumbs = previewSlider.querySelectorAll('img');
      thumbs.forEach((el, i) => el.classList.toggle('active', i === index));
      centerThumbInSlider(index); // ★ 항상 중앙으로
    };

    const goToSlide = (index) => {
      const slide = carouselTrack.children[index];
      if (!slide) return;
      slide.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });
      currentIndex = index;
      updateSliderActive(index);
    };

    // ✅ Safari-safe: 초기 1번 이미지 고정
    async function safariSafeInitFirstSlide() {
      // 1) 초기 스냅 비활성화(사파리 랜덤 스냅 방지)
      const prevSnap = carouselContainer.style.scrollSnapType;
      carouselContainer.style.scrollSnapType = 'none';

      // 2) 첫 이미지가 디코드/로드될 때까지 대기
      const imgs = Array.from(carouselTrack.querySelectorAll('img'));
      const firstImg = imgs[0];
      if (!firstImg) return;

      try {
        await firstImg.decode();
      } catch {
        if (!firstImg.complete) {
          await new Promise(res => firstImg.addEventListener('load', res, { once: true }));
        }
      }

      // 3) 정확 좌표로 스크롤 (scrollIntoView 대신 offsetLeft 사용)
      carouselContainer.scrollLeft = 0;  // 초기화
      previewSlider.scrollLeft = 0;
      const left = firstImg.offsetLeft;
      carouselContainer.scrollTo({ left, behavior: 'auto' });

      // 4) 인덱스/썸네일 동기화
      currentIndex = 0;
      updateSliderActive(0);

      // 5) 다음 프레임에 스냅 복원
      requestAnimationFrame(() => {
        carouselContainer.style.scrollSnapType = prevSnap || 'x mandatory';
      });
    }

    // 링크가 다운로드 대상인지 간단 판별(확장자 기준)
    function isDownloadable(href) {
      const exts = ['.pdf', '.zip', '.jpg', '.jpeg', '.png', '.gif', '.webp', '.txt', '.md', '.doc', '.docx', '.ppt', '.pptx', '.xls', '.xlsx'];
      const low = href.toLowerCase();
      return exts.some(ext => low.endsWith(ext));
    }

    // 링크 HTML 문자열 생성
    function renderLinkHTML(link) {
      if (!link) return '';
      const href = link.trim();
      const downloadAttr = isDownloadable(href) ? ' download' : '';

      const icon = isDownloadable(href)
        ? '<img src="img/icon/ic_download.svg" alt="Download" class="icon-btn" />'
        : '<img src="img/icon/ic_outlink.svg" alt="Open link" class="icon-btn" />';

      return `
    <p style="margin-top:16px">
      <a href="${href}" target="_blank" rel="noopener"${downloadAttr}
         style="display:inline-flex;align-items:center;gap:6px;text-decoration:none;">
        <span>${isDownloadable(href) ? 'Download file' : 'Open link'}</span>
         ${icon}
      </a>
    </p>
  `;
    }



    // ===== 렌더 =====
    function renderCarousel(images) {
      const list = (images || []).filter(Boolean); // ★ 빈 문자열 방지
      carouselTrack.innerHTML = list.map((src, i) => `<img src="${src}" loading="lazy" draggable="false" data-idx="${i}"/>`).join('');

    }

    function initSlider(images) {
      const list = (images || []).filter(Boolean);
      previewSlider.innerHTML = list.map((src, i) => `<img src="${src}" loading="lazy" data-index="${i}" />`).join('');
      previewSlider.querySelectorAll('img').forEach((img) => {
        img.addEventListener('click', () => {
          const target = Number(img.dataset.index);
          goToSlide(target);
        });
      });
    }

    // ===== 초기 세팅 =====
    if (detail) {
      detailText.innerHTML = `
      <h3>${detail.title}</h3>
      ${detail.subtitle ? `<p><strong>${detail.subtitle}</strong></p>` : ''}
      <p>${detail.body || ''}</p>
      ${renderLinkHTML(detail.link || '')}
    `;
      if (detail.images && Array.isArray(detail.images) && detail.images.filter(src => src && src.trim() !== "").length > 0) {
        renderCarousel(detail.images);
        initSlider(detail.images);
        safariSafeInitFirstSlide();
      } else {
        // ✅ 이미지가 없으면 높이 0
        carouselTrack.style.height = '0px';
        carouselContainer.style.height = '0px';
      }

    }
    //  상세 페이지에 작품 스키마(VisualArtwork) 넣기
    if (detail) {
      // ... 기존 detailText 렌더 코드

      // ✅ 작품 구조화 데이터 주입
      const toAbs = (src) => src && (src.startsWith('http')
        ? src
        : new URL(src, location.origin).href);
      const images = Array.isArray(detail.images) ? detail.images.filter(Boolean) : [];
      const ld = {
        "@context": "https://schema.org",
        "@type": "FineArtwork",
        "name": detail.title,
        "image": images.length ? images.map(toAbs) : (detail.img ? [toAbs(detail.img)] : undefined),
        "description": (detail.subtitle ? detail.subtitle.replace(/<br\/?>/g, ' ') + ' ' : '') + (detail.body || ''),
        "creator": { "@type": "Person", "name": "Jang Da Eun" },
        "url": location.href
      };
      const s = document.createElement('script');
      s.type = 'application/ld+json';
      s.textContent = JSON.stringify(ld);
      document.head.appendChild(s);

      // (선택) 정규 URL을 고정
      const link = document.createElement('link');
      link.rel = 'canonical';
      link.href = location.href;
      document.head.appendChild(link);
    }

    // ===== 캐러셀 스크롤 → 현재 인덱스 추적 =====
    let rafId = null;
    const onScroll = () => {
      if (rafId) cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(() => {
        const w = getSlideWidth();
        const idx = Math.round(carouselContainer.scrollLeft / w);
        if (idx !== currentIndex) {
          currentIndex = idx;
          updateSliderActive(idx);
        }
      });
    };
    carouselContainer.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', () => {
      // 리사이즈 시에도 중앙 유지
      updateSliderActive(currentIndex);
    });

    // ===== Back 버튼 (기존 동일) =====
    const backBtn = document.querySelector('.back-btn');
    if (backBtn && nav && subnav && id) {
      backBtn.innerHTML = `&lt; Show all ${subnav}`;
      backBtn.addEventListener('click', (e) => {
        e.preventDefault();
        localStorage.setItem('scrollToId', id);

        const isGithubPages = window.location.pathname.includes('/jangdaeun/');
        const base = isGithubPages ? './index.html' : 'index.html';

        const href = `${base}?nav=${encodeURIComponent(nav || 'art')}`
          + `&subnav=${encodeURIComponent(subnav || 'works')}`
          + `&id=${encodeURIComponent(id)}`;

        window.location.assign(href);
      });
    }

    // ✅ 콘텐츠가 1개뿐인 nav에서는 back 버튼 숨김 (visibility 유지)
    if (detail) {
      const sameNavItems = contents.filter(i => i.nav === detail.nav);
      if (sameNavItems.length === 1) {
        const backBtn = document.querySelector('.back-btn');
        if (backBtn) {
          backBtn.style.display = 'none';
          backBtn.style.pointerEvents = 'none';
        }
      }
    }



    (function () {
      const items = (window && window.contents) ? window.contents : [];
      const $ = s => document.querySelector(s);
      const cap = s => s ? s.charAt(0).toUpperCase() + s.slice(1) : '';
      const uniq = a => [...new Set(a)];

      const navEl = document.querySelector('nav');
      const subEl =
        document.getElementById('subnavContainer') ||
        document.getElementById('artSubnav') ||
        document.getElementById('textSubnav');

      const url = new URL(location.href);
      const idParam = url.searchParams.get('id');
      let navParam = url.searchParams.get('nav');
      let subParam = url.searchParams.get('subnav') || '';

      const current = items.find(i => String(i.id) === String(idParam));
      if (!navParam && current) navParam = current.nav || '';
      if (!subParam && current) subParam = current.subnav || '';

      const navs = uniq(items.map(i => i.nav).filter(Boolean));

      // ✅ 모든 탭을 index.html로 이동하는 링크로 생성
      navEl.innerHTML =
        navs.map(n => `
      <a class="tab ${n === navParam ? 'active' : ''}"
         href="./index.html?nav=${encodeURIComponent(n)}">
        ${cap(n)}
      </a>
    `).join('') +
        `
      <a class="tab ${navParam === 'cv' ? 'active' : ''}" href="./index.html?nav=cv">CV</a>
      <a class="tab ${navParam === 'contact' ? 'active' : ''}" href="./index.html?nav=contact">Contact</a>
    `;

      // ✅ subnav도 index.html 링크로 이동
      if (subEl) {
        const subs = uniq(items.filter(i => i.nav === navParam && i.subnav).map(i => i.subnav));
        if (subs.length) {
          subEl.style.display = 'flex';
          subEl.innerHTML = subs.map(s => `
        <a class="subtab ${s === subParam ? 'active' : ''}"
           href="./index.html?nav=${encodeURIComponent(navParam)}&subnav=${encodeURIComponent(s)}">
          ${cap(s)}
        </a>
      `).join('');
        } else {
          subEl.style.display = 'none';
          subEl.innerHTML = '';
        }
      }
    })();
  </script>

</body>

</html>