<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Work Detail</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="/img/favicon.png" />
  <style>
    .carousel-container {
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-x;
      scrollbar-width: none;
      /* Firefox */
      -ms-overflow-style: none;
    }

    .carousel-container::-webkit-scrollbar {
      display: none;
      /* Chrome, Safari */
    }

    .carousel-track {
      display: flex;
      scroll-behavior: smooth;
      width: max-content;
    }

    .carousel-track img {
      flex-shrink: 0;
      width: 100vw;
      max-height: 70vh;
      scroll-snap-align: start;
      object-fit: contain;
    }
  </style>
</head>

<body>
  <header>
    <a href="./index.html">Jang da eun</a>
  </header>
  <nav>
    <a class="tab" data-tab="art">Art</a>
    <a class="tab" data-tab="text">Text</a>
    <a class="tab" data-tab="cv" href="./index.html?nav=cv">CV</a>
    <a class="tab" data-tab="contact" href="./index.html?nav=contact">Contact</a>
  </nav>
  <div class="page-wrapper">
    <div class="subnav" id="subnavContainer">
      <a class="subtab" data-subtab="works">Works</a>
      <a class="subtab" data-subtab="drawing">Drawing</a>
      <a class="subtab" data-subtab="statement">Statement</a>
      <a class="subtab" data-subtab="text">Text</a>
    </div>
    <div class="content-area">
      <div class="content">
        <div class="detail">
          <div class="carousel-container">
            <div class="carousel-track" id="carouselTrack"></div>
          </div>
          <div class="slider" id="previewSlider"></div>
          <div id="detailText"></div>
        </div>
        <div class="back-btn">&lt; Show all</div>
      </div>
    </div>
  </div>

  <footer>
    <div class="top"></div>
    <div class="btm">Â© 2025 Jang Da Eun - All Rights Reserved</div>
  </footer>

  <script type="module">
    import { contents } from './data.js';

    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const nav = params.get('nav');
    const subnav = params.get('subnav');

    if (nav) {
      const navTab = document.querySelector(`.tab[data-tab="${nav}"]`);
      if (navTab) navTab.classList.add('active');
    }

    if (subnav) {
      const subTab = document.querySelector(`.subtab[data-subtab="${subnav}"]`);
      if (subTab) subTab.classList.add('active');
    }

    const subnavMap = {
      art: ['works', 'drawing'],
      text: ['statement', 'text']
    };

    const allowedSubtabs = subnavMap[nav] || [];
    document.querySelectorAll('.subtab').forEach(tab => {
      const type = tab.getAttribute('data-subtab');
      tab.style.display = allowedSubtabs.includes(type) ? 'inline-block' : 'none';
    });

    const detail = contents.find(item => item.id === id);
    const carouselTrack = document.getElementById('carouselTrack');
    const detailText = document.getElementById('detailText');
    const previewSlider = document.getElementById('previewSlider');

    let currentIndex = 0;

    function renderCarousel(images) {
      carouselTrack.innerHTML = images.map(src => `
    <img src="${src}" loading="lazy" />
  `).join('');
    }


    function updateSliderActive(index) {
      const thumbs = previewSlider.querySelectorAll('img');
      thumbs.forEach((el, i) => {
        el.classList.toggle('active', i === index);
      });
    }

    function initSlider(images) {
      previewSlider.innerHTML = images.map((src, i) => `
    <img src="${src}" loading="lazy" data-index="${i}" />
  `).join('');

      previewSlider.querySelectorAll('img').forEach((img, i) => {
        img.addEventListener('click', () => {
          const slide = carouselTrack.children[i];
          slide.scrollIntoView({ behavior: 'smooth', inline: 'start' });
        });
      });
    }



    if (detail) {
      detailText.innerHTML = `
        <h3>${detail.title}</h3>
        ${detail.subtitle ? `<p><strong>${detail.subtitle}</strong></p>` : ''}
        <p>${detail.body}</p>
      `;

      if (detail.images && detail.images.length > 0) {
        renderCarousel(detail.images);
        initSlider(detail.images);
      }
    }

    const backBtn = document.querySelector('.back-btn');
    if (backBtn && nav && subnav && id) {
      backBtn.innerHTML = `&lt; Show all ${subnav}`;
      backBtn.addEventListener('click', () => {
        localStorage.setItem('scrollToId', id);
        const url = new URL('./index.html', window.location.origin);
        url.searchParams.set('nav', nav);
        url.searchParams.set('subnav', subnav);
        url.searchParams.set('id', id);
        window.location.href = url.toString();
      });
    }

    document.querySelectorAll('.tab, .subtab').forEach(tab => {
      tab.addEventListener('click', () => {
        const navAttr = tab.classList.contains('tab') ? tab.dataset.tab : params.get('nav');
        const subnavAttr = tab.classList.contains('subtab') ? tab.dataset.subtab : null;

        const path = window.location.pathname;
        const isGithubPages = path.includes('/jangdaeun/');
        const basePath = isGithubPages ? '/jangdaeun/' : './';

        const url = new URL(`${basePath}index.html`, window.location.origin);
        url.searchParams.set('nav', navAttr);
        if (subnavAttr) {
          url.searchParams.set('subnav', subnavAttr);
        }

        window.location.href = url.toString();
      });
    });
  </script>
</body>

</html>